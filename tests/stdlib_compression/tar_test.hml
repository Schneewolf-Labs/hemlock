// Test tar archive creation and reading
import { TarWriter, TarReader, TAR_TYPE_FILE, TAR_TYPE_DIRECTORY } from "@stdlib/compression";

// Create a tar archive
let writer = TarWriter();

// Add a directory
writer.add_directory("myproject");

// Add some files
writer.add_file("myproject/README.md", "# My Project\n\nThis is a test project.");
writer.add_file("myproject/main.hml", "print(\"Hello, World!\");");
writer.add_file("myproject/data.txt", "Some data content here.");

// Build the archive
let tar_data = writer.build();

// Verify entry count
print(writer.count() == 4);  // true (1 dir + 3 files)

// Parse the archive
let reader = TarReader(tar_data);

// Verify entry count
print(reader.count() == 4);  // true

// List entries
let names = reader.list();
print(names.length == 4);  // true

// Check contains
print(reader.contains("myproject/"));  // true
print(reader.contains("myproject/README.md"));  // true
print(reader.contains("nonexistent.txt"));  // false

// Get specific entry
let readme = reader.get("myproject/README.md");
print(readme != null);  // true
print(readme.name == "myproject/README.md");  // true
print(readme.content == "# My Project\n\nThis is a test project.");  // true
print(readme.type == TAR_TYPE_FILE);  // true

// Get directory entry
let dir = reader.get("myproject/");
print(dir != null);  // true
print(dir.type == TAR_TYPE_DIRECTORY);  // true

// Cleanup
free(tar_data);

print("Tar archive tests passed!");
